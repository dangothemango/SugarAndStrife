<!doctype html>
<html lang="en">
<head>
    <title>VIDEO GAME</title>
    <script type="text/javascript" src=engine/phaser.js></script>
    <script type="text/javascript" src=js/MenuState.js></script>
    <script type="text/javascript" src=js/PlayState.js></script>
    <script type="text/javascript" src=js/Cutscene.js></script>
    <script type="text/javascript" src=js/WinState.js></script>
    <script type="text/javascript" src=js/Ingredients.js></script>
    <script type="text/javascript" src=js/Book.js></script>
    <script type="text/javascript" src=js/WinConditions.js></script>
    <script type="text/javascript" src=js/FinalCandy.js></script>
    <script type="text/javascript" src=js/CutsceneContent.js></script>

    <style type="text/css">
        body {
            margin-top: 0px;
            margin-left: 0px;
        }
    </style>
</head>
<body>
<script type="text/javascript">
    
    var game = new Phaser.Game(1334, 750, Phaser.AUTO, '', { preload: preload, create: create, update: update});

    var debug=false;
    var debugLevel=5;

    //MAIN VARIABLES
    var rand=new Phaser.RandomDataGenerator();
    var tmpItem;
    var style = { font: "65px Arial", fill:"ffffff", align: "center"};
    var bookTitle = { font: "32px Verdana", fontWeight: 'bold', fill:"#4D3F3E", wordWrap: true, align:'left', wordWrapWidth:1334/64*21};
    var bookStyle = { font: "32px Verdana", fill:"#4D3F3E", wordWrap: true, align:'left', wordWrapWidth:1334/64*21};
    var uiStyle = { font: "22px corbel", fontWeight: 'bold', fill:"#4D3F3E", boundsAlignH: "left", boundsAlignV: "middle", wordWrap: false };
    var chalkStyle = { font: "16px corbel", fill:"#FFF", boundsAlignH: "left", boundsAlignV: "middle", wordWrap: false };
    var CSStyle = { font: "24px corbel", fontWeight: 'bold', fill:"#1F1F1F", boundsAlignH: "left", boundsAlignV: "middle", wordWrap: true, wordWrapWidth: 200 };

    //PLAY STATE VARIABLES
    var group;
    var cauldron;
    var closedBook;
    var text;
    var wincandy = [];
    var ingredientsInCauldron = []; // an array of all of the ingredients currently in the cauldron
    var flavorList = []; // an array of all of the current flavors
    var effects = []; // an array of all of the current effects
    var sparkles=false;
    var currentColor = [0, 0, 0];
    var numCol = 0; // number of colored ingredients currently in the cauldron
    var totalIngred = 0;
    var crabCount;
    var winCondition = 0;
    var ing;
    var bookPages;
    var shelf_index = 0;
    var dirty = false; // does the cauldron have dirt in it
    
    var bgm;
    var dm_soundeffect;
    var liquid_soundeffect;
    var powder_soundeffect;
    var solid_soundeffect;

    var itemheight = 119.5; // height of an item slot in pixels
    var itemwidth = 207; // width of an item slot in pixels
    var shelfwidth = 4; // number of items that fit on the shelf horizontally
    var shelfheight = 4; // number of items that fit on the shelf vertically

    var cornerX = 112;
    var cornerY = 46;

    var right_button;
    var left_button;

    var flav1;
    var flav2;
    var flav3;
    var flav4;
    var flav5;

    var attributes;

    var flavors_string = "";
    var effects_string = "";

    // items on the left page
    var items_left = [];
    // items on the right page
    var items_right = [];


    var dragged_item = null;

    //CUTSCENE VARIABLE

    game.state.add('Menu', MenuState);
    game.state.add('Play', PlayState);
    game.state.add('Cut', Cutscene);
    game.state.add('Win', WinState);


    game.state.start('Menu');


    function preload() {
        game.load.atlasJSONHash('submitButton', 'assets/images/buttons/blank_buttons.png','assets/images/buttons/blank_buttons.json');
        game.load.atlas('items', 'assets/images/items.png', 'assets/images/items.json', Phaser.Loader.TEXTURE_ATLAS_JSON_HASH);
        game.load.image('cauldron', 'assets/images/cauldron alt.png');
        game.load.image('bg', 'assets/images/background vector.png');
        game.load.image('square', 'assets/images/square.png');
        game.load.atlasJSONHash('right_arrow', 'assets/images/rightarrow.png', 'assets/images/rightarrow.json');
        game.load.atlasJSONHash('left_arrow', 'assets/images/leftarrow.png', 'assets/images/leftarrow.json');
        game.load.image('bookScreen','assets/images/flat_book_desaturated.png');
        game.load.image('notFound','assets/images/notfoundicon.png');
        
        //sound
        game.load.audio('bgm', 'assets/sounds/backgroundMusicSkewedPaths.ogg');
        game.load.audio('dm_soundeffect', 'assets/sounds/addDarkmatter.wav');
        game.load.audio('liquid_soundeffect', 'assets/sounds/addLiquid.wav');
        game.load.audio('powder_soundeffect', 'assets/sounds/addPowder.wav');
        game.load.audio('solid_soundeffect', 'assets/sounds/addSolid.wav');
    }

    function create() {
    }

    function update() {

    }

    //COMMON FUNCTIONS
    /*
    function _drag(item) {
        //pos = item.position;
        //enables drag on item held
        tmpItem = game.add.sprite(item.x, item.y, item.key, item.frame);
        tmpItem.events.onInputDown.add(_drag, Phaser.StateManager.current);
        tmpItem.scale.set(0.5,0.5);
        tmpItem.inputEnabled=true;

        //fix_ordering(item, tmpItem);

        item.x -= 30;
        item.y -= 30;
        item.input.enableDrag();

        item.scale.set(0.7, 0.7); // make the dragged item a little bigger

        //if dropped check if dropped in cauldron
        item.events.onDragStop.add(PlayState.dropHandler, this);
    }*/

    function nextLevel(){
        PlayState.levelNum+=1;
        startLevel();
    }
    
    function _drag(item) {
        //pos = item.position;
        //enables drag on item held
        tmpItem = game.add.sprite(item.x, item.y, item.key, item.frame);
        tmpItem.scale.set(0.7, 0.7);
        tmpItem.inputEnabled = true;

        dragged_item = tmpItem;
        //tmpItem.input.enableDrag();
    }

    function add_item(item) {
        //max 16 ingredients on each shelf
        Ingredients[item].known.name=true;
        if (items_left.length < 16) {
            items_left.push(item);
        }
        else {
            items_right.push(item);
        }
    }

    function fix_ordering(spriteA, spriteB) {
        game.world.swap(spriteA, spriteB);
    }

    function checkOverlap(spriteA, spriteB) {
        var boundsA = spriteA.getBounds();
        var boundsB = spriteB.getBounds();

        return Phaser.Rectangle.intersects(boundsA, boundsB);
    }
    
    //MENU STATE FUNCTIONS
    function startLevel() {
        Cutscene.sceneData=CutsceneContent[PlayState.levelNum].open;
        Cutscene.opening=true;
        game.state.start('Cut');
    }

    //CUTSCENE FUNCTIONS


    //PLAY STATE FUNCTIONS
    function submitCandy() {
        if (totalIngred===0) return;
        if (PlayState.checkWin()){
            PlayState.generateCandy();
        }
        //Book.open(0);
    }

    //WIN STATE FUNCTIONS

</script>
</body>
</html>
