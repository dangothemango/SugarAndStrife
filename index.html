<!doctype html>
<html lang="en">
<head>
    <title>VIDEO GAME</title>
    <script type="text/javascript" src=engine/phaser.js></script>
    <script type="text/javascript" src=js/MenuState.js></script>
    <script type="text/javascript" src=js/PlayState.js></script>
    <script type="text/javascript" src=js/Cutscene.js></script>
    <script type="text/javascript" src=js/WinState.js></script>
    <script type="text/javascript" src=js/Ingredients.js></script>
    <script type="text/javascript" src=js/Book.js></script>

    <style type="text/css">
        body {
            margin-top: 0px;
            margin-left: 0px;
        }
    </style>
</head>
<body>
<script type="text/javascript">
    
    var game = new Phaser.Game(1334, 750, Phaser.AUTO, '', { preload: preload, create: create, update: update});

    //MAIN VARIABLES
    var tmpItem;
    var style = { font: "65px Arial", fill:"ffffff", align: "center"};
    var bookStyle = style;
    bookStyle.wordWrap=true;
    bookStyle.wordWrapWidth=1334/8*3;
    bookStyle.align='left';

    //PLAY STATE VARIABLES
    var group;
    var cauldron;
    var text;
    var wincandy = [];
    var ingredientsInCauldron = []; // an array of all of the ingredients currently in the cauldron
    var flavorList = []; // an array of all of the current flavors
    var effects = []; // an array of all of the current effects
    var currentColor = [0, 0, 0];
    var numCol = 0; // number of colored ingredients currently in the cauldron
    var totalIngred = 0;
    var crabCount;
    var winCondition = 0;
    var ing;
    var bookPages;
    var shelf_index = 0;
    var dirty = false; // does the cauldron have dirt in it
    
    var bgm;
    var dm_soundeffect;
    var liquid_soundeffect;
    var powder_soundeffect;
    var solid_soundeffect;

    var itemheight = 119.5; // height of an item slot in pixels
    var itemwidth = 207; // width of an item slot in pixels
    var shelfwidth = 4; // number of items that fit on the shelf horizontally
    var shelfheight = 4; // number of items that fit on the shelf vertically

    var cornerX = 112;
    var cornerY = 46;

    var right_button;
    var left_button;


    // items on the left page
    var items_left = [];
    // items on the right page
    var items_right = [];


    var dragged_item = null;

    //CUTSCENE VARIABLE
    var cutsceneText="";

    game.state.add('Menu', MenuState);
    game.state.add('Play', PlayState);
    game.state.add('Cut', Cutscene);
    game.state.add('Win', WinState);


    game.state.start('Menu');

    function preload() {
    }

    function create() {
    }

    function update() {

    }

    //COMMON FUNCTIONS
    /*
    function _drag(item) {
        //pos = item.position;
        //enables drag on item held
        tmpItem = game.add.sprite(item.x, item.y, item.key, item.frame);
        tmpItem.events.onInputDown.add(_drag, Phaser.StateManager.current);
        tmpItem.scale.set(0.5,0.5);
        tmpItem.inputEnabled=true;

        //fix_ordering(item, tmpItem);

        item.x -= 30;
        item.y -= 30;
        item.input.enableDrag();

        item.scale.set(0.7, 0.7); // make the dragged item a little bigger

        //if dropped check if dropped in cauldron
        item.events.onDragStop.add(PlayState.dropHandler, this);
    }*/
    
    function _drag(item) {
        //pos = item.position;
        //enables drag on item held
        tmpItem = game.add.sprite(item.x, item.y, item.key, item.frame);
        tmpItem.scale.set(0.7, 0.7);
        tmpItem.inputEnabled = true;

        dragged_item = tmpItem;
        //tmpItem.input.enableDrag();
    }

    function add_item(item) {
        //max 16 ingredients on each shelf
        if (items_left.length < 16) {
            items_left.push(item);
        }
        else {
            items_right.push(item);
        }
    }

    function fix_ordering(spriteA, spriteB) {
        game.world.swap(spriteA, spriteB);
    }

    function checkOverlap(spriteA, spriteB) {
        var boundsA = spriteA.getBounds();
        var boundsB = spriteB.getBounds();

        return Phaser.Rectangle.intersects(boundsA, boundsB);
    }
    
    //MENU STATE FUNCTIONS
    function startGame() {
        cutsceneText="Horrible Dirt";
        game.state.start('Cut');
    }

    //CUTSCENE FUNCTIONS


    //PLAY STATE FUNCTIONS
    function submitCandy() {
        if (PlayState.checkWin()){
            game.state.start('Menu');
        } else {
            Book.open(0);
        }
    }

    //WIN STATE FUNCTIONS

</script>
</body>
</html>
